<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ActivityPub 協定的基本教學（上） | 北郊獨語 - Yoxem&#39;s Blog</title>
  <meta name="author" content="Yoxem Chen">
  
  <meta name="description" content="（最近更新：2022-11-23，勘誤）
序言隨着馬斯克入主推特後對內激進整飭的作爲，許多人想到避難目標 Mastodon。但是也不一定要入駐 Mastodon，因為 Mastodon 是利用去中心化 ActivityPub 協定跨伺服器傳遞訊息的，所以只要支援 ActivityPub 的 SNS 平臺，比如 Pleroma、MissKey 都可以使用。
另外鑑於有些人反映 Mastodon 的效率太慢，其實也可以自己製作支援 ActivityPub 的微網誌服務軟體。我之前本來想要做一組SNS，但是發現這個 side-project 會嚴重侵蝕自己的作息控制和身心健康，所以擱置了。
但是鑑於這個去中心化協定獲得的關注度很高，而網路上幾乎沒有華語的教學，從而沒有辦法百花齊放，推進這個技術的生態圈，洵為可惜，加上自己曾經參與一篇 Timmot 的教學的回饋，所以就用該教學來編譯成華語，希望能夠推動大家對這個協議的興趣。
如果這個教學有錯誤處請告訴我。另筆者不負責參考本教學執行的後果，還請注意。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="ActivityPub 協定的基本教學（上）"/>
  <meta property="og:site_name" content="北郊獨語 - Yoxem&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  


    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "ActivityPub 協定的基本教學（上）",
       "datePublished": "2022-11-20T23:21:55+08:00",
       "dateModified" : "2023-06-13T10:14:58+08:00",
      "author": [{
          "@type": "Person",
          "name": "Yoxem Chen",
          "url": "https://kianting.info"
        }],
       "keywords" :    ["資訊","ActivityPub","Python","Django"] ,
      "abstract" : "（最近更新：2022-11-23，勘誤）\n序言隨着馬斯克入主推特後對內激進整飭的作爲，許多人想到避難目標 Mastodon。但是也不一定要入駐 Mastodon，因為 Mastodon 是利用去中心化 ActivityPub 協定跨伺服器傳遞訊息的，所以只要支援 ActivityPub 的 SNS 平臺，比如 Pleroma、MissKey 都可以使用。\n另外鑑於有些人反映 Mastodon 的效率太慢，其實也可以自己製作支援 ActivityPub 的微網誌服務軟體。我之前本來想要做一組SNS，但是發現這個 side-project 會嚴重侵蝕自己的作息控制和身心健康，所以擱置了。\n但是鑑於這個去中心化協定獲得的關注度很高，而網路上幾乎沒有華語的教學，從而沒有辦法百花齊放，推進這個技術的生態圈，洵為可惜，加上自己曾經參與一篇 Timmot 的教學的回饋，所以就用該教學來編譯成華語，希望能夠推動大家對這個協議的興趣。\n如果這個教學有錯誤處請告訴我。另筆者不負責參考本教學執行的後果，還請注意。",
      "text" : "（最近更新：2022-11-23，勘誤）\n序言隨着馬斯克入主推特後對內激進整飭的作爲，許多人想到避難目標 Mastodon。但是也不一定要入駐 Mastodon，因為 Mastodon 是利用去中心化 ActivityPub 協定跨伺服器傳遞訊息的，所以只要支援 ActivityPub 的 SNS 平臺，比如 Pleroma、MissKey 都可以使用。\n另外鑑於有些人反映 Mastodon 的效率太慢，其實也可以自己製作支援 ActivityPub 的微網誌服務軟體。我之前本來想要做一組SNS，但是發現這個 side-project 會嚴重侵蝕自己的作息控制和身心健康，所以擱置了。\n但是鑑於這個去中心化協定獲得的關注度很高，而網路上幾乎沒有華語的教學，從而沒有辦法百花齊放，推進這個技術的生態圈，洵為可惜，加上自己曾經參與一篇 Timmot 的教學的回饋，所以就用該教學來編譯成華語，希望能夠推動大家對這個協議的興趣。\n如果這個教學有錯誤處請告訴我。另筆者不負責參考本教學執行的後果，還請注意。\n\n教學簡介教學的 Python 程式碼改自 timmot 的 ActivityPub 教學，將 原教學使用的 Flask 後端框架翻譯成 Django 這個 Python 網頁後端框架的版本，使用 MIT 授權。\n其中會先教到如何使用 Nginx 伺服器驅動一個新設置的 Django 專案，再用這個專案改成能夠傳輸 ActivityPub json 訊息之軟體。\n先備條件以下教學適用環境如下：\n會 Python 和 Django 的基礎知識。\n\nUbuntu 20.04（我是在 Docker 裏面測試，但是實機應該也可以照樣用）\nPython 3.10.6\nDjango 4.1.3\n一組浮動 IP\nNo-IP Linux DUC Stable version 2.1.9\ncertbot 1.32.0\n\n基礎軟體安裝Nginx HTTP 伺服器安裝 nginx：\n12$ sudo apt update$ sudo apt install nginx\n\n確認一下 systemtctl 有沒有開啓 nginx，沒有則開啓：\n1$ sudo systemctl start nginx\n\n這時候打開瀏覽器，進入 127.0.0.1 這個代表自己電腦的 IP，看到下列文字，代表成功了：\n123 Welcome to nginx! If you see this page, the nginx web server is successfully installed and working. Further configuration is required....\n\nPython 程式語言因為 Django 是 Python 語言的後端框架，所以需要安裝 Python，和安裝 Python 套件的工具 pip：\n1$ sudo apt install python3-pip python-3\n\nDjango 安裝、建置專案安裝 virtualenv、建立環境目錄爲了隔離開發環境的依賴模組，我們把 Python 套件用 virtualenv 安裝在自定的目錄裏面，避免動到系統全局的套件安裝，所以先安裝 virtualenv：\n1$ pip3 install virtualenv #安裝 virtualenv \n\n在家目錄或其他適當的地方建立新目錄 my_folder，並在裏面建立自己的環境目錄my_env，套用環境：\n12345user@host:~$ mkdir my_folderuser@host:~$ cd my_folderuser@host:~/my_folder$ virtualenv my_env #建立自己的環境目錄user@host:~/my_folder$ source my_env/bin/activate #進入自己的環境(my_env) user@host:~/my_folder$ \n\n在環境目錄內安裝 Django最後灌 Django 框架到環境目錄內：\n1(my_env) user@host:~/my_folder$ pip3 install django\n\n建立自己的測試專案用 django-admin 建立測試專案資料夾 activitypub_test：\n1(my_env) user@host:~/my_folder$ django-admin startproject activitypub_test\n\n安裝時區資料 tzdata爲了正確處理時區資訊，需要安裝 tzdata：\n1pip3 install tzdata\n\nGunicorn和 uWSGI 一樣，提供伺服器軟體和 Python Django 網頁後端框架溝通的橋樑：\n1(my_env) user@host:~/my_folder$ pip3 install gunicorn\n\n進去自己的專案目錄，然後測試，出現類似下列的字樣，可以 Ctrl-z 離開：\n123456(my_env) user@host:~/my_folder$ cd activitypub_test(my_env) user@host:~/my_folder/activitypub_test$ gunicorn --bind 0.0.0.0:8000 activitypub_test.wsgi[2022-11-19 09:14:29 +0000] [54] [INFO] Starting gunicorn 20.1.0[2022-11-19 09:14:29 +0000] [54] [INFO] Listening at: http://0.0.0.0:8000 (54)[2022-11-19 09:14:29 +0000] [54] [INFO] Using worker: sync...\n\n爲了讓系統起動時能夠自動開啓 gunicorn，需要建立下列兩個 Systemd 的設定檔案：\n\n&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;gunicorn.socket\n\n12345678[Unit]Description=gunicorn socket[Socket]ListenStream=/run/gunicorn.sock[Install]WantedBy=sockets.target\n\n\n&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;gunicorn.service\n\n1234567891011121314151617[Unit]Description=gunicorn daemonRequires=gunicorn.socketAfter=network.target[Service]User=userGroup=www-dataWorkingDirectory=/home/my_folder/activitypub_testExecStart=/home/my_folder/my_env/bin/gunicorn \\          --access-logfile - \\          --workers 3 \\          --bind unix:/run/gunicorn.sock \\          activitypub_test.wsgi:application[Install]WantedBy=multi-user.target\n\n啓動 gunicorn：\n1sudo systemctl start gunicorn\n\nNginx 設定建立該設定檔 &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;activitypub_test.conf：\n1234567891011121314151617181920server &#123;listen 80;server_name 127.0.0.1;# https://docs.djangoproject.com/en/dev/howto/static-files/#serving-static-files-in-production# location /static &#123; # STATIC_URL#    root /var/www/html/;#                  &#125;    location / &#123;            proxy_set_header Host $host;            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;            proxy_set_header X-Scheme $scheme;            proxy_pass http://127.0.0.1:8000;        &#125;&#125;\n\n建立設定檔連結給 nginx 使用，測試設定檔，然後重啓服務：\n123ln -s /etc/nginx/sites-available/activitypub_test.conf /etc/nginx/sites-enablednginx -t # 測試設定檔有沒有問題sudo systemctl restart nginx # 重啓 nginx 服務\n\n嘗試連到 127.0.0.1，應該會出現這個結果，代表正常運作：\n\n\n設定防火牆：\n12sudo ufw delete allow 8000sudo ufw allow &#x27;Nginx Full&#x27;\n\n浮動 IP 轉址（DDNS）設定因為我們使用浮動 IP，另外 ActivityPub 協定需要域名，所以需要動態轉址。以下採用 No-IP 的服務設定。\n假設創立新賬戶，申請到 activitypub-test.ddns.net 這個網址後，到No-ip 的用戶端下載頁 下載。\n解壓縮之後，編譯解壓縮：\n1234tar xvf noip-duc-linux.tar.gzcd noip-2.1.9-1makemake install\n\n在 make install 這個階段裏，依指示輸入之後。就設定動態轉址完畢。\n啓用 noip2 客戶端程式：\n1/usr/local/bin/noip2\n\n修改 Nginx 設定檔的第 3 行server_name 127.0.0.1;為server_name activitypub-test.ddns.net;，如下：\n1234server &#123;listen 80;server_name activitypub-test.ddns.net;...\n\n然後將 Nginx 重啓：\n1sudo nginx -s reload\n\n到專案目錄裏面，開啓settings.py：\n12cd ~/my_folder/activitypub_test/activitypub_test/nano settings.py\n\n將ALLOWED_HOSTS = [] 這行添加我們新申請的域名，變成：ALLOWED_HOSTS = [&#39;activitypub-test.ddns.net&#39;]；存檔然後離開。\n最後重啓 gunicorn：\n1sudo systemctl restart gunicorn\n\n連進去 activitypub-test.ddns.net 就應該可以看到 Django 測試頁面了。\n設定 HTTPS 憑證等（用 Certbot）安裝方法\n123sudo apt install snapd # 安裝 Snap 套件管理程式sudo snap install --classic certbot # 安裝 certbotsudo ln -s /snap/bin/certbot /usr/bin/certbot # 建立執行檔連結到 /usr/bin/\n\n執行 certbot，取得 HTTPS 證書：\n1sudo certbot --nginx\n\n會得到證書和私鑰的連結：\n12345...Successfully received certificate.Certificate is saved at: /etc/letsencrypt/live/activitypub-test.ddns.net/fullchain.pemKey is saved at:         /etc/letsencrypt/live/activitypub-test.ddns.net/privkey.pem...\n\n &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;activitypub_test.conf 這個 nginx 也會被修改，增加 HTTPS 的功能。\n產生公私鑰因為 HTTP Signature 需要公私鑰，所以需要產生一組：\n123mkdir ~/my_folder/my_keys; cd ~/my_folder/my_keys # 建立新目錄並進入openssl genrsa -out private.pem 2048 # 產生私鑰openssl rsa -in private.pem -outform PEM -pubout -out public.pem # 產生公鑰\n\n建構 ActivityPub 伺服器\n閱讀之前可以參考ActivityPub協定的介紹（英文）\n這裏我們假設一個用戶，id 叫 alice，我們可以這樣寫伺服器：\n\n先匯入必要的函式庫、函數等先進入~/my_folder/activitypub_test/專案頁面。開啓 activitypub_test/views.py，匯入必要的函式庫：\n 12345678910 from django.http import HttpResponse # 回傳一般的 HTTP 的回應 (response)from django.http import HttpResponseNotFound # 回傳 404 回應from django.views.decorators.csrf import csrf_exempt #不檢查 csrf tokenimport json # 處理 json 用import os.path # 處理路徑用&#x27;&#x27;&#x27;設定基本用戶 alice 的變數和域名&#x27;&#x27;&#x27;default_user_name = &quot;alice&quot;  #　id 名稱default_shown_name = &quot;Alice&quot; # 顯示名稱domain = &quot;activitypub-test.ddns.net&quot; # 域名\n\n製作可以回傳用戶基本資料的 json開啓 activitypub_test/urls.py，新增一個網頁規則：\n123456789from django.contrib import adminfrom django.urls import pathfrom . import viewsurlpatterns = [    path(&#x27;admin/&#x27;, admin.site.urls),    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info), # 回傳用戶資料用]\n\n開啓activitypub_test/views.py，建立user_info函數，決定回傳的內容。如果 username 是 alice，回傳其個人資訊：\n123456789101112131415161718192021222324252627282930313233343536373839# 回傳使用者資料def user_info(request, username):    # 使用者公鑰的檔案路徑，這裏使用本站 https 的公鑰    home_folder = os.path.expanduser(&quot;~&quot;)    public_key_path = os.path.join(home_folder, &quot;my_folder/my_keys/public.pem&quot;)     public_key = open(public_key_path, &#x27;r&#x27;).read() #　輸入公鑰    &#x27;&#x27;&#x27;若是輸入的 user_name 不是 default_user_name，回傳找不到。&#x27;&#x27;&#x27;    if username != default_user_name:        return HttpResponseNotFound(&quot;the user name doesn&#x27;t exist.&quot;)    else:	      # 個人資料的 dict        user_info_dict = &#123;        &quot;@context&quot;: [            &quot;https://www.w3.org/ns/activitystreams&quot;, # 應該是協定的部分            &quot;https://w3id.org/security/v1&quot;,        ],        &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;&quot;, # 指向使用者的頁面        &quot;inbox&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;/inbox&quot;, # 收信匣        &quot;outbox&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;/outbox&quot;, # 寄信匣        &quot;type&quot;: &quot;Person&quot;,        &quot;name&quot;: default_shown_name, # 使用者顯示名稱        &quot;preferredUsername&quot;: username, #　使用者的 id 名稱		    # 公鑰部分：        &quot;publicKey&quot;: &#123;            &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;#main-key&quot;,            &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;&quot;,            &quot;publicKeyPem&quot;: public_key            &#125;        &#125;		        user_info_json = json.dumps(user_info_dict) # 轉成 json        # 將 json 轉成 response，然後設定 content-type，最後回傳        user_info_json_response = HttpResponse(user_info_json,		                              content_type = &#x27;application/activity+json&#x27;)        return user_info_json_response\n建立 Webfinger 資訊Webfinger 是辨識使用者或其他實體的方法，採用一組獨特的 URI。位址形式有點像是 email。\nactivitypub_test/urls.py 的 urlpatterns 改成：\n1234urlpatterns = [    path(&#x27;admin/&#x27;, admin.site.urls),    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info),    path(&#x27;.well-known/webfinger&#x27;, views.webfingr), # webfinger 用\n開啓activitypub_test/views.py，建立webfinger函數，決定回傳的 webfinger 資訊。如果 username 是 alice，回傳其個人資訊：\n123456789101112131415161718192021222324252627# 傳遞 webfinger 資料def webfinger(request):    webfinger = request.GET.get(&#x27;resource&#x27;) # 得到用 GET 方法傳來的 resource（位址）    &#x27;&#x27;&#x27;將 &#x27;alice&#x27; 轉成 webfinger 位址	  形式如 acct:alice@activitypub_test.ddns.org&#x27;&#x27;&#x27;    account = &quot;acct:&quot; + default_user_name + &quot;@&quot; + domain    # 如果查詢的不是 alice 的位址，則回傳找不到    if webfinger != account:        return HttpResponseNotFound(&quot;can&#x27;t find the user in the site.&quot;)   # 如果查詢的是 alice，回傳個人資料的 json    webfinger_dict = &#123;        &quot;subject&quot;: account,        &quot;links&quot;: [            &#123;                &quot;rel&quot;: &quot;self&quot;,                &quot;type&quot;: &quot;application/activity+json&quot;,                &quot;href&quot;: f&quot;https://&#123;domain&#125;/users/&#123;default_user_name&#125;&quot;            &#125;        ]    &#125;    # 回傳 json    return HttpResponse(json.dumps(webfinger_dict),	                      content_type = &quot;application/jrd+json&quot;)\n\n建立 inbox（收信匣）雖然也可以建立 outbox，但是這裏爲求方便，僅說明建立 inbox，以接受其他人傳來的 json 訊息。\nctivitypub_test/urls.py 的 urlpatterns 改成：\n123456urlpatterns = [    path(&#x27;admin/&#x27;, admin.site.urls),    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info),    path(&#x27;.well-known/webfinger&#x27;, views.webfinger),    path(&#x27;users/&lt;username&gt;/inbox&#x27;, views.inbox), # 收信匣]\n開啓activitypub_test/views.py，建立ibox函數，當做收信匣。另外我們把收到的信息存在 inbox_log.txt 裏面：\n123456789101112131415161718192021222324@csrf_exempt # 不要進行 csrf token 檢查def inbox(request, username):    # 預設傳訊息的 inbox 使用 POST 方法    if request.method == &#x27;POST&#x27;:        log = open(&#x27;inbox_log.txt&#x27;, &#x27;a&#x27;) # 打開 inbox_log.txt 這個 log        		    # 如果不是 alice，回傳找不到        if username != default_user_name:            HttpResponseNotFound(&quot;can&#x27;t get the inbox&quot;)        header = request.headers # request 的 header        data = request.body # request 的內容        # 將 request 的內容寫在 log 裏面，然後關掉：        text = f&#x27;message:\\n&#123;header&#125; \\n&#123;data&#125;\\n&#x27;        log.write(text)        log.close()		        # 最後回傳 OK        return HttpResponse(&quot;OK&quot;)	  #其他情況回傳找不到    else:        return HttpResponseNotFound(&quot;can&#x27;t get the inbox&quot;)\n如何寄送跟隨請求？可參後文\n參考\ntimmot &#x2F;activity-pub-tutorial\nInstall and configure Nginx\nHow to Start, Stop, or Restart Nginx\nGunicorn Installation\nmysite.wsgi file is missing after creating django project\nHow To Set Up Django with Postgres, Nginx, and Gunicorn on Ubuntu 22.04\nInvalid http_host header\nZoneInfoNotFoundError: ‘No time zone found with key utc’\nCertbot Instructions - Nginx on Ubuntu 20\n\n "
    }
    </script>



  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="/atom.xml" title="北郊獨語 - Yoxem&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<meta name="google-site-verification" content="3t0bNOKnnsVyNpsfuM7Vi6gf-6tY_MUeOpXmJzDZ_P8" /> <!-- google search opt.-->
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">北郊獨語 - Yoxem&#39;s Blog</a></h1>
  <h2 class="subtitle">溪埔的石仔、山嶺的果樹之間，version 3.0</h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home 首頁</a></li>
    
      <li><a href="/archives">Archives 彙整</a></li>
    
      <li><a href="/about.html">About 關於</a></li>
    
      <li><a href="/googlephoto.html">Albums 相簿</a></li>
    
      <li><a href="/blogroll.html">Blogroll 聯播</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
      <li><a target="_blank" rel="noopener" href="http://yoxemblog.wordpress.com">Old Articles 舊文章</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2022-11-20T15:21:55.000Z"><a href="/2022/11/20/activitypub-e-kipun-kauhak-1/">2022-11-20</a></time>
      
      
  
    <h1 class="title">ActivityPub 協定的基本教學（上）</h1>
  

    </header>
    <div class="entry">
      
        
          <div class="toc" style="font-size: 100%; border-style:solid; border-width 0.1px; border-color: #787878; float: right; width: 25%; padding: 20px;border-width: 1px; border-margin: 10px;margin-left: 10px;margin-bottom: 10px; background: #f6f7f9;"><span style="text-align:center;font-weight:bold;">目錄</span>
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E8%A8%80"><span class="toc-text">序言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%99%E5%AD%B8%E7%B0%A1%E4%BB%8B"><span class="toc-text">教學簡介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E5%82%99%E6%A2%9D%E4%BB%B6"><span class="toc-text">先備條件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A4%8E%E8%BB%9F%E9%AB%94%E5%AE%89%E8%A3%9D"><span class="toc-text">基礎軟體安裝</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx-HTTP-%E4%BC%BA%E6%9C%8D%E5%99%A8"><span class="toc-text">Nginx HTTP 伺服器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80"><span class="toc-text">Python 程式語言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Django-%E5%AE%89%E8%A3%9D%E3%80%81%E5%BB%BA%E7%BD%AE%E5%B0%88%E6%A1%88"><span class="toc-text">Django 安裝、建置專案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D-virtualenv%E3%80%81%E5%BB%BA%E7%AB%8B%E7%92%B0%E5%A2%83%E7%9B%AE%E9%8C%84"><span class="toc-text">安裝 virtualenv、建立環境目錄</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%92%B0%E5%A2%83%E7%9B%AE%E9%8C%84%E5%85%A7%E5%AE%89%E8%A3%9D-Django"><span class="toc-text">在環境目錄內安裝 Django</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%87%AA%E5%B7%B1%E7%9A%84%E6%B8%AC%E8%A9%A6%E5%B0%88%E6%A1%88"><span class="toc-text">建立自己的測試專案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%9D%E6%99%82%E5%8D%80%E8%B3%87%E6%96%99-tzdata"><span class="toc-text">安裝時區資料 tzdata</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gunicorn"><span class="toc-text">Gunicorn</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx-%E8%A8%AD%E5%AE%9A"><span class="toc-text">Nginx 設定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%AE%E5%8B%95-IP-%E8%BD%89%E5%9D%80%EF%BC%88DDNS%EF%BC%89%E8%A8%AD%E5%AE%9A"><span class="toc-text">浮動 IP 轉址（DDNS）設定</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A8%AD%E5%AE%9A-HTTPS-%E6%86%91%E8%AD%89%E7%AD%89%EF%BC%88%E7%94%A8-Certbot%EF%BC%89"><span class="toc-text">設定 HTTPS 憑證等（用 Certbot）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A2%E7%94%9F%E5%85%AC%E7%A7%81%E9%91%B0"><span class="toc-text">產生公私鑰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E6%A7%8B-ActivityPub-%E4%BC%BA%E6%9C%8D%E5%99%A8"><span class="toc-text">建構 ActivityPub 伺服器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E5%8C%AF%E5%85%A5%E5%BF%85%E8%A6%81%E7%9A%84%E5%87%BD%E5%BC%8F%E5%BA%AB%E3%80%81%E5%87%BD%E6%95%B8%E7%AD%89"><span class="toc-text">先匯入必要的函式庫、函數等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%BD%E4%BD%9C%E5%8F%AF%E4%BB%A5%E5%9B%9E%E5%82%B3%E7%94%A8%E6%88%B6%E5%9F%BA%E6%9C%AC%E8%B3%87%E6%96%99%E7%9A%84-json"><span class="toc-text">製作可以回傳用戶基本資料的 json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-Webfinger-%E8%B3%87%E8%A8%8A"><span class="toc-text">建立 Webfinger 資訊</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B-inbox%EF%BC%88%E6%94%B6%E4%BF%A1%E5%8C%A3%EF%BC%89"><span class="toc-text">建立 inbox（收信匣）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AF%84%E9%80%81%E8%B7%9F%E9%9A%A8%E8%AB%8B%E6%B1%82%EF%BC%9F"><span class="toc-text">如何寄送跟隨請求？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%83%E8%80%83"><span class="toc-text">參考</span></a></li></ol>
          </div>
        
      <p><strong>（最近更新：2022-11-23，勘誤）</strong></p>
<h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>隨着馬斯克入主推特後對內激進整飭的作爲，許多人想到避難目標 Mastodon。但是也不一定要入駐 Mastodon，因為 Mastodon 是利用去中心化 ActivityPub 協定跨伺服器傳遞訊息的，所以只要支援 ActivityPub 的 SNS 平臺，比如 Pleroma、MissKey 都可以使用。</p>
<p>另外鑑於有些人反映 Mastodon 的效率太慢，其實也可以自己製作支援 ActivityPub 的微網誌服務軟體。我之前<a target="_blank" rel="noopener" href="https://github.com/Yoxem/khaikang">本來想要做一組SNS</a>，但是發現這個 side-project 會嚴重侵蝕自己的作息控制和身心健康，所以擱置了。</p>
<p>但是鑑於這個去中心化協定獲得的關注度很高，而網路上幾乎沒有華語的教學，從而沒有辦法百花齊放，推進這個技術的生態圈，洵為可惜，加上自己曾經參與一篇 Timmot 的教學的回饋，所以就用該教學來編譯成華語，希望能夠推動大家對這個協議的興趣。</p>
<p>如果這個教學有錯誤處請告訴我。另筆者不負責參考本教學執行的後果，還請注意。</p>
<span id="more"></span>
<h2 id="教學簡介"><a href="#教學簡介" class="headerlink" title="教學簡介"></a>教學簡介</h2><p>教學的 Python 程式碼改自 <a target="_blank" rel="noopener" href="https://github.com/timmot">timmot</a> 的 ActivityPub 教學，將 原教學使用的 Flask 後端框架翻譯成 Django 這個 Python 網頁後端框架的版本，使用 <a target="_blank" rel="noopener" href="https://github.com/timmot/activity-pub-tutorial/blob/master/LICENSE">MIT 授權</a>。</p>
<p>其中會先教到如何使用 Nginx 伺服器驅動一個新設置的 Django 專案，再用這個專案改成能夠傳輸 ActivityPub json 訊息之軟體。</p>
<h3 id="先備條件"><a href="#先備條件" class="headerlink" title="先備條件"></a>先備條件</h3><p>以下教學適用環境如下：</p>
<p>會 Python 和 Django 的基礎知識。</p>
<ul>
<li>Ubuntu 20.04（我是在 Docker 裏面測試，但是實機應該也可以照樣用）</li>
<li>Python 3.10.6</li>
<li>Django 4.1.3</li>
<li>一組浮動 IP</li>
<li>No-IP Linux DUC Stable version 2.1.9</li>
<li>certbot 1.32.0</li>
</ul>
<h2 id="基礎軟體安裝"><a href="#基礎軟體安裝" class="headerlink" title="基礎軟體安裝"></a>基礎軟體安裝</h2><h3 id="Nginx-HTTP-伺服器"><a href="#Nginx-HTTP-伺服器" class="headerlink" title="Nginx HTTP 伺服器"></a>Nginx HTTP 伺服器</h3><p>安裝 nginx：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install nginx</span><br></pre></td></tr></table></figure>

<p>確認一下 systemtctl 有沒有開啓 nginx，沒有則開啓：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start nginx</span><br></pre></td></tr></table></figure>

<p>這時候打開瀏覽器，進入 127.0.0.1 這個代表自己電腦的 IP，看到下列文字，代表成功了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Welcome to nginx!</span><br><span class="line"> If you see this page, the nginx web server is successfully installed and working. Further configuration is required.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Python-程式語言"><a href="#Python-程式語言" class="headerlink" title="Python 程式語言"></a>Python 程式語言</h3><p>因為 Django 是 Python 語言的後端框架，所以需要安裝 Python，和安裝 Python 套件的工具 pip：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install python3-pip python-3</span><br></pre></td></tr></table></figure>

<h3 id="Django-安裝、建置專案"><a href="#Django-安裝、建置專案" class="headerlink" title="Django 安裝、建置專案"></a>Django 安裝、建置專案</h3><h4 id="安裝-virtualenv、建立環境目錄"><a href="#安裝-virtualenv、建立環境目錄" class="headerlink" title="安裝 virtualenv、建立環境目錄"></a>安裝 virtualenv、建立環境目錄</h4><p>爲了隔離開發環境的依賴模組，我們把 Python 套件用 virtualenv 安裝在自定的目錄裏面，避免動到系統全局的套件安裝，所以先安裝 virtualenv：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install virtualenv #安裝 virtualenv </span><br></pre></td></tr></table></figure>

<p>在家目錄或其他適當的地方建立新目錄 <code>my_folder</code>，並在裏面建立自己的環境目錄<code>my_env</code>，套用環境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user@host:~$ mkdir my_folder</span><br><span class="line">user@host:~$ cd my_folder</span><br><span class="line">user@host:~/my_folder$ virtualenv my_env #建立自己的環境目錄</span><br><span class="line">user@host:~/my_folder$ source my_env/bin/activate #進入自己的環境</span><br><span class="line">(my_env) user@host:~/my_folder$ </span><br></pre></td></tr></table></figure>

<h4 id="在環境目錄內安裝-Django"><a href="#在環境目錄內安裝-Django" class="headerlink" title="在環境目錄內安裝 Django"></a>在環境目錄內安裝 Django</h4><p>最後灌 Django 框架到環境目錄內：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(my_env) user@host:~/my_folder$ pip3 install django</span><br></pre></td></tr></table></figure>

<h4 id="建立自己的測試專案"><a href="#建立自己的測試專案" class="headerlink" title="建立自己的測試專案"></a>建立自己的測試專案</h4><p>用 django-admin 建立測試專案資料夾 <code>activitypub_test</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(my_env) user@host:~/my_folder$ django-admin startproject activitypub_test</span><br></pre></td></tr></table></figure>

<h3 id="安裝時區資料-tzdata"><a href="#安裝時區資料-tzdata" class="headerlink" title="安裝時區資料 tzdata"></a>安裝時區資料 tzdata</h3><p>爲了正確處理時區資訊，需要安裝 tzdata：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install tzdata</span><br></pre></td></tr></table></figure>

<h3 id="Gunicorn"><a href="#Gunicorn" class="headerlink" title="Gunicorn"></a>Gunicorn</h3><p>和 uWSGI 一樣，提供伺服器軟體和 Python Django 網頁後端框架溝通的橋樑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(my_env) user@host:~/my_folder$ pip3 install gunicorn</span><br></pre></td></tr></table></figure>

<p>進去自己的專案目錄，然後測試，出現類似下列的字樣，可以 <code>Ctrl-z</code> 離開：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(my_env) user@host:~/my_folder$ cd activitypub_test</span><br><span class="line">(my_env) user@host:~/my_folder/activitypub_test$ gunicorn --bind 0.0.0.0:8000 activitypub_test.wsgi</span><br><span class="line">[2022-11-19 09:14:29 +0000] [54] [INFO] Starting gunicorn 20.1.0</span><br><span class="line">[2022-11-19 09:14:29 +0000] [54] [INFO] Listening at: http://0.0.0.0:8000 (54)</span><br><span class="line">[2022-11-19 09:14:29 +0000] [54] [INFO] Using worker: sync</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>爲了讓系統起動時能夠自動開啓 gunicorn，需要建立下列兩個 Systemd 的設定檔案：</p>
<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;gunicorn.socket</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=gunicorn socket</span><br><span class="line"></span><br><span class="line">[Socket]</span><br><span class="line">ListenStream=/run/gunicorn.sock</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sockets.target</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;gunicorn.service</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=gunicorn daemon</span><br><span class="line">Requires=gunicorn.socket</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=user</span><br><span class="line">Group=www-data</span><br><span class="line">WorkingDirectory=/home/my_folder/activitypub_test</span><br><span class="line">ExecStart=/home/my_folder/my_env/bin/gunicorn \</span><br><span class="line">          --access-logfile - \</span><br><span class="line">          --workers 3 \</span><br><span class="line">          --bind unix:/run/gunicorn.sock \</span><br><span class="line">          activitypub_test.wsgi:application</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>啓動 gunicorn：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start gunicorn</span><br></pre></td></tr></table></figure>

<h4 id="Nginx-設定"><a href="#Nginx-設定" class="headerlink" title="Nginx 設定"></a>Nginx 設定</h4><p>建立該設定檔 &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;activitypub_test.conf：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name 127.0.0.1;</span><br><span class="line"></span><br><span class="line"># https://docs.djangoproject.com/en/dev/howto/static-files/#serving-static-files-in-production</span><br><span class="line"># location /static &#123; # STATIC_URL</span><br><span class="line">#    root /var/www/html/;</span><br><span class="line">#                  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Scheme $scheme;</span><br><span class="line">            proxy_pass http://127.0.0.1:8000;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>建立設定檔連結給 nginx 使用，測試設定檔，然後重啓服務：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/nginx/sites-available/activitypub_test.conf /etc/nginx/sites-enabled</span><br><span class="line">nginx -t # 測試設定檔有沒有問題</span><br><span class="line">sudo systemctl restart nginx # 重啓 nginx 服務</span><br></pre></td></tr></table></figure>

<p>嘗試連到 127.0.0.1，應該會出現這個結果，代表正常運作：</p>
<img src="/2022/11/20/activitypub-e-kipun-kauhak-1/DjangoTestPage.png" class="" title="Django 測試成功畫面">

<p>設定防火牆：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw delete allow 8000</span><br><span class="line">sudo ufw allow &#x27;Nginx Full&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="浮動-IP-轉址（DDNS）設定"><a href="#浮動-IP-轉址（DDNS）設定" class="headerlink" title="浮動 IP 轉址（DDNS）設定"></a>浮動 IP 轉址（DDNS）設定</h3><p>因為我們使用浮動 IP，另外 ActivityPub 協定需要域名，所以需要動態轉址。以下採用 No-IP 的服務設定。</p>
<p>假設創立新賬戶，申請到 <code>activitypub-test.ddns.net</code> 這個網址後，到<a target="_blank" rel="noopener" href="https://www.noip.com/download?page=linux">No-ip 的用戶端下載頁</a> 下載。</p>
<p>解壓縮之後，編譯解壓縮：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar xvf noip-duc-linux.tar.gz</span><br><span class="line">cd noip-2.1.9-1</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>在 <code>make install</code> 這個階段裏，依指示輸入之後。就設定動態轉址完畢。</p>
<p>啓用 noip2 客戶端程式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/noip2</span><br></pre></td></tr></table></figure>

<p>修改 Nginx 設定檔的第 3 行<code>server_name 127.0.0.1;</code>為<code>server_name activitypub-test.ddns.net;</code>，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name activitypub-test.ddns.net;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>然後將 Nginx 重啓：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>

<p>到專案目錄裏面，開啓<code>settings.py</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/my_folder/activitypub_test/activitypub_test/</span><br><span class="line">nano settings.py</span><br></pre></td></tr></table></figure>

<p>將<code>ALLOWED_HOSTS = []</code> 這行添加我們新申請的域名，變成：<code>ALLOWED_HOSTS = [&#39;activitypub-test.ddns.net&#39;]</code>；<br>存檔然後離開。</p>
<p>最後重啓 gunicorn：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart gunicorn</span><br></pre></td></tr></table></figure>

<p>連進去 <code>activitypub-test.ddns.net</code> 就應該可以看到 Django 測試頁面了。</p>
<h4 id="設定-HTTPS-憑證等（用-Certbot）"><a href="#設定-HTTPS-憑證等（用-Certbot）" class="headerlink" title="設定 HTTPS 憑證等（用 Certbot）"></a>設定 HTTPS 憑證等（用 Certbot）</h4><p>安裝方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install snapd # 安裝 Snap 套件管理程式</span><br><span class="line">sudo snap install --classic certbot # 安裝 certbot</span><br><span class="line">sudo ln -s /snap/bin/certbot /usr/bin/certbot # 建立執行檔連結到 /usr/bin/</span><br></pre></td></tr></table></figure>

<p>執行 certbot，取得 HTTPS 證書：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure>

<p>會得到證書和私鑰的連結：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Successfully received certificate.</span><br><span class="line">Certificate is saved at: /etc/letsencrypt/live/activitypub-test.ddns.net/fullchain.pem</span><br><span class="line">Key is saved at:         /etc/letsencrypt/live/activitypub-test.ddns.net/privkey.pem</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p> &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;activitypub_test.conf 這個 nginx 也會被修改，增加 HTTPS 的功能。</p>
<h4 id="產生公私鑰"><a href="#產生公私鑰" class="headerlink" title="產生公私鑰"></a>產生公私鑰</h4><p>因為 HTTP Signature 需要公私鑰，所以需要產生一組：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/my_folder/my_keys; cd ~/my_folder/my_keys # 建立新目錄並進入</span><br><span class="line">openssl genrsa -out private.pem 2048 # 產生私鑰</span><br><span class="line">openssl rsa -in private.pem -outform PEM -pubout -out public.pem # 產生公鑰</span><br></pre></td></tr></table></figure>

<h2 id="建構-ActivityPub-伺服器"><a href="#建構-ActivityPub-伺服器" class="headerlink" title="建構 ActivityPub 伺服器"></a>建構 ActivityPub 伺服器</h2><ul>
<li>閱讀之前可以參考<a target="_blank" rel="noopener" href="https://www.w3.org/TR/activitypub/#Overview">ActivityPub協定的介紹</a>（英文）</li>
<li>這裏我們假設一個用戶，id 叫 alice，我們可以這樣寫伺服器：</li>
</ul>
<h3 id="先匯入必要的函式庫、函數等"><a href="#先匯入必要的函式庫、函數等" class="headerlink" title="先匯入必要的函式庫、函數等"></a>先匯入必要的函式庫、函數等</h3><p>先進入<code>~/my_folder/activitypub_test/</code>專案頁面。<br>開啓 <code>activitypub_test/views.py</code>，匯入必要的函式庫：</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> from django.http import HttpResponse # 回傳一般的 HTTP 的回應 (response)</span><br><span class="line">from django.http import HttpResponseNotFound # 回傳 404 回應</span><br><span class="line">from django.views.decorators.csrf import csrf_exempt #不檢查 csrf token</span><br><span class="line">import json # 處理 json 用</span><br><span class="line">import os.path # 處理路徑用</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;設定基本用戶 alice 的變數和域名&#x27;&#x27;&#x27;</span><br><span class="line">default_user_name = &quot;alice&quot;  #　id 名稱</span><br><span class="line">default_shown_name = &quot;Alice&quot; # 顯示名稱</span><br><span class="line">domain = &quot;activitypub-test.ddns.net&quot; # 域名</span><br></pre></td></tr></table></figure>

<h3 id="製作可以回傳用戶基本資料的-json"><a href="#製作可以回傳用戶基本資料的-json" class="headerlink" title="製作可以回傳用戶基本資料的 json"></a>製作可以回傳用戶基本資料的 json</h3><p>開啓 <code>activitypub_test/urls.py</code>，新增一個網頁規則：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info), # 回傳用戶資料用</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>開啓<code>activitypub_test/views.py</code>，建立<code>user_info</code>函數，決定回傳的內容。如果 username 是 alice，回傳其個人資訊：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 回傳使用者資料</span><br><span class="line">def user_info(request, username):</span><br><span class="line">    # 使用者公鑰的檔案路徑，這裏使用本站 https 的公鑰</span><br><span class="line">    home_folder = os.path.expanduser(&quot;~&quot;)</span><br><span class="line">    public_key_path = os.path.join(home_folder, &quot;my_folder/my_keys/public.pem&quot;) </span><br><span class="line"></span><br><span class="line">    public_key = open(public_key_path, &#x27;r&#x27;).read() #　輸入公鑰</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;若是輸入的 user_name 不是 default_user_name，回傳找不到。&#x27;&#x27;&#x27;</span><br><span class="line">    if username != default_user_name:</span><br><span class="line">        return HttpResponseNotFound(&quot;the user name doesn&#x27;t exist.&quot;)</span><br><span class="line"></span><br><span class="line">    else:</span><br><span class="line">	      # 個人資料的 dict</span><br><span class="line">        user_info_dict = &#123;</span><br><span class="line">        &quot;@context&quot;: [</span><br><span class="line">            &quot;https://www.w3.org/ns/activitystreams&quot;, # 應該是協定的部分</span><br><span class="line">            &quot;https://w3id.org/security/v1&quot;,</span><br><span class="line">        ],</span><br><span class="line">        &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;&quot;, # 指向使用者的頁面</span><br><span class="line">        &quot;inbox&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;/inbox&quot;, # 收信匣</span><br><span class="line">        &quot;outbox&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;/outbox&quot;, # 寄信匣</span><br><span class="line">        &quot;type&quot;: &quot;Person&quot;,</span><br><span class="line">        &quot;name&quot;: default_shown_name, # 使用者顯示名稱</span><br><span class="line">        &quot;preferredUsername&quot;: username, #　使用者的 id 名稱</span><br><span class="line">		    # 公鑰部分：</span><br><span class="line">        &quot;publicKey&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;#main-key&quot;,</span><br><span class="line">            &quot;id&quot;: f&quot;https://&#123;domain&#125;/users/&#123;username&#125;&quot;,</span><br><span class="line">            &quot;publicKeyPem&quot;: public_key</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        user_info_json = json.dumps(user_info_dict) # 轉成 json</span><br><span class="line"></span><br><span class="line">        # 將 json 轉成 response，然後設定 content-type，最後回傳</span><br><span class="line">        user_info_json_response = HttpResponse(user_info_json,</span><br><span class="line">		                              content_type = &#x27;application/activity+json&#x27;)</span><br><span class="line">        return user_info_json_response</span><br></pre></td></tr></table></figure>
<h3 id="建立-Webfinger-資訊"><a href="#建立-Webfinger-資訊" class="headerlink" title="建立 Webfinger 資訊"></a>建立 Webfinger 資訊</h3><p>Webfinger 是辨識使用者或其他實體的方法，採用一組獨特的 URI。位址形式有點像是 email。</p>
<p><code>activitypub_test/urls.py</code> 的 <code>urlpatterns</code> 改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info),</span><br><span class="line">    path(&#x27;.well-known/webfinger&#x27;, views.webfingr), # webfinger 用</span><br></pre></td></tr></table></figure>
<p>開啓<code>activitypub_test/views.py</code>，建立<code>webfinger</code>函數，決定回傳的 webfinger 資訊。如果 username 是 alice，回傳其個人資訊：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 傳遞 webfinger 資料</span><br><span class="line">def webfinger(request):</span><br><span class="line">    webfinger = request.GET.get(&#x27;resource&#x27;) # 得到用 GET 方法傳來的 resource（位址）</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;將 &#x27;alice&#x27; 轉成 webfinger 位址</span><br><span class="line">	  形式如 acct:alice@activitypub_test.ddns.org&#x27;&#x27;&#x27;</span><br><span class="line">    account = &quot;acct:&quot; + default_user_name + &quot;@&quot; + domain</span><br><span class="line"></span><br><span class="line">    # 如果查詢的不是 alice 的位址，則回傳找不到</span><br><span class="line">    if webfinger != account:</span><br><span class="line">        return HttpResponseNotFound(&quot;can&#x27;t find the user in the site.&quot;)</span><br><span class="line"></span><br><span class="line">   # 如果查詢的是 alice，回傳個人資料的 json</span><br><span class="line">    webfinger_dict = &#123;</span><br><span class="line">        &quot;subject&quot;: account,</span><br><span class="line">        &quot;links&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;rel&quot;: &quot;self&quot;,</span><br><span class="line">                &quot;type&quot;: &quot;application/activity+json&quot;,</span><br><span class="line">                &quot;href&quot;: f&quot;https://&#123;domain&#125;/users/&#123;default_user_name&#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 回傳 json</span><br><span class="line">    return HttpResponse(json.dumps(webfinger_dict),</span><br><span class="line">	                      content_type = &quot;application/jrd+json&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="建立-inbox（收信匣）"><a href="#建立-inbox（收信匣）" class="headerlink" title="建立 inbox（收信匣）"></a>建立 inbox（收信匣）</h3><p>雖然也可以建立 outbox，但是這裏爲求方便，僅說明建立 inbox，以接受其他人傳來的 json 訊息。</p>
<p><code>ctivitypub_test/urls.py</code> 的 <code>urlpatterns</code> 改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">    path(&#x27;users/&lt;username&gt;&#x27;, views.user_info),</span><br><span class="line">    path(&#x27;.well-known/webfinger&#x27;, views.webfinger),</span><br><span class="line">    path(&#x27;users/&lt;username&gt;/inbox&#x27;, views.inbox), # 收信匣</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>開啓<code>activitypub_test/views.py</code>，建立<code>ibox</code>函數，當做收信匣。另外我們把收到的信息存在 <code>inbox_log.txt</code> 裏面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@csrf_exempt # 不要進行 csrf token 檢查</span><br><span class="line">def inbox(request, username):</span><br><span class="line">    # 預設傳訊息的 inbox 使用 POST 方法</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        log = open(&#x27;inbox_log.txt&#x27;, &#x27;a&#x27;) # 打開 inbox_log.txt 這個 log</span><br><span class="line">        </span><br><span class="line">		    # 如果不是 alice，回傳找不到</span><br><span class="line">        if username != default_user_name:</span><br><span class="line">            HttpResponseNotFound(&quot;can&#x27;t get the inbox&quot;)</span><br><span class="line"></span><br><span class="line">        header = request.headers # request 的 header</span><br><span class="line">        data = request.body # request 的內容</span><br><span class="line"></span><br><span class="line">        # 將 request 的內容寫在 log 裏面，然後關掉：</span><br><span class="line">        text = f&#x27;message:\n&#123;header&#125; \n&#123;data&#125;\n&#x27;</span><br><span class="line">        log.write(text)</span><br><span class="line">        log.close()</span><br><span class="line">		</span><br><span class="line">        # 最後回傳 OK</span><br><span class="line">        return HttpResponse(&quot;OK&quot;)</span><br><span class="line">	  #其他情況回傳找不到</span><br><span class="line">    else:</span><br><span class="line">        return HttpResponseNotFound(&quot;can&#x27;t get the inbox&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="如何寄送跟隨請求？"><a href="#如何寄送跟隨請求？" class="headerlink" title="如何寄送跟隨請求？"></a>如何寄送跟隨請求？</h3><p><a href="https://yoxem.github.io/2022/11/22/activitypub-e-tshiok-thoo'muai-e-sim'tit">可參後文</a></p>
<h2 id="參考"><a href="#參考" class="headerlink" title="參考"></a>參考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/timmot/activity-pub-tutorial">timmot &#x2F;activity-pub-tutorial</a></li>
<li><a target="_blank" rel="noopener" href="https://ubuntu.com/tutorials/install-and-configure-nginx#1-overview">Install and configure Nginx</a></li>
<li><a target="_blank" rel="noopener" href="https://linuxize.com/post/start-stop-restart-nginx/">How to Start, Stop, or Restart Nginx</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.gunicorn.org/en/stable/install.html">Gunicorn Installation</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28873121/mysite-wsgi-file-is-missing-after-creating-django-project">mysite.wsgi file is missing after creating django project</a></li>
<li><a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-22-04">How To Set Up Django with Postgres, Nginx, and Gunicorn on Ubuntu 22.04</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/40582423/invalid-http-host-header">Invalid http_host header</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/71058888/zoneinfonotfounderror-no-time-zone-found-with-key-utc">ZoneInfoNotFoundError: ‘No time zone found with key utc’</a></li>
<li><a target="_blank" rel="noopener" href="https://certbot.eff.org/instructions?ws=nginx&os=ubuntufocal">Certbot Instructions - Nginx on Ubuntu 20</a></li>
</ul>
<script type="text/javascript"> var head = document.getElementsByTagName("head"); var link_css = document.createElement('style'); link_css.setAttribute('type', 'text/css'); link_css.innerHTML = ' .css-table1{ display: table; border: none;} .css-tr1{ display:table-row; } .css-td1{ display: table-cell; padding-right: 1ex; }'; document.getElementsByTagName('head')[0].appendChild(link_css);</script>
      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Blog/">Blog</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/資訊/">資訊</a>, <a href="/tags/ActivityPub/">ActivityPub</a>, <a href="/tags/Python/">Python</a>, <a href="/tags/Django/">Django</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>


      
      <div class="clearfix"></div>
    </footer>
  <!-- hexo-list-related-posts -->

<div style="margin-top: 0px; border-top: 1px solid #ddd; padding-top: 26px">    
 <h3 class="related-posts-heading">關聯文章</h3><ul class="related-posts"><li class="related-posts-item"><a class="related-posts-link" href="/2022/11/22/activitypub-e-tshiok-thoo'muai-e-sim'tit/">ActivityPub 協定的基本踩坑心得（下）</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2019/06/25/tue7hue5ha7kang3e5suatbing5/">遞迴下降分析器的簡介</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2023/04/10/Mng5khau2tiann5-e5-ui5hoo7liok8/">門口埕記事1：用樹莓派 3 運作 Pleroma 要三思</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2011/07/19/解決-cx_freeze-做出的-exe-檔無法在中文路徑下執行的錯誤/">解決 cx_Freeze 做出的 .exe 檔無法在中文路徑下執行的問題</a></li><li class="related-posts-item"><a class="related-posts-link" href="/2019/10/12/tua7soo3ji7tu5huat4ian2sng3huat4/">大數字除法演算法——Newton 法 ê 變形</a></li></ul>    </div>
        

  </div>

</article>


<section id="comment">
  <h1 class="title">Comments</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div></div>
    <aside id="sidebar" class="alignright">
  <!-- the license of the file is under cc by-sa 3.0 by RobG and Yoxem et al.-->
<div class="search">

  <form name="search_form" action="//google.com/search" method="get" accept-charset="utf-8" class="search-form" onsubmit="search_form.q.value = search_form.hq.value + search_form.q.value "><!-- the source code in the line is modified from RobG's under CC BY-SA 3.0 (https://creativecommons.org/licenses/by-sa/3.0/) -->
    <input type="search" name="hq" results="0" value="" placeholder="Search" class="search-form-input">
	<!-- custom add the url of yoxem's old blog -->
<input name="q" type="hidden" value=" site:yoxem.github.io OR site:yoxemblog.wordpress.com">



 </form>
</div>
 


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/Blog/">Blog</a><small>141</small></li>
  
    <li><a href="/categories/上代blog的文章/">上代blog的文章</a><small>5</small></li>
  
    <li><a href="/categories/家私-tools/">家私 (tools)</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2023/07/23/latex-tng-tsua-ian-sng-huat/">LaTeX斷行演算法</a>
      </li>
    
      <li>
        <a href="/2023/07/16/ua-tat-hing-piat-e-li-kai/">一個外行對依值型別的理解</a>
      </li>
    
      <li>
        <a href="/2023/07/11/ko&#39;jin-wiki-2023-Q2/">個人wiki最近更新（2023年4-6月）</a>
      </li>
    
      <li>
        <a href="/2023/04/24/mng5khau2tiann5-sua2tsam7/">門口埕記事2：二代機初步完成啟用</a>
      </li>
    
      <li>
        <a href="/2023/04/15/ko&#39;jin-wiki-tsue&#39;kin-king&#39;sin-2023-Q1/">個人wiki最近更新（2023年1-3月）</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/ActivityPub/" style="font-size: 11.54px;">ActivityPub</a> <a href="/tags/Clochur/" style="font-size: 10px;">Clochur</a> <a href="/tags/Django/" style="font-size: 10.77px;">Django</a> <a href="/tags/English/" style="font-size: 10px;">English</a> <a href="/tags/Esperanto/" style="font-size: 10.77px;">Esperanto</a> <a href="/tags/Fediverse/" style="font-size: 10.77px;">Fediverse</a> <a href="/tags/Gaeilge/" style="font-size: 10.77px;">Gaeilge</a> <a href="/tags/GooglePhoto/" style="font-size: 10px;">GooglePhoto</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Holo%E8%A9%B1/" style="font-size: 19.23px;">Holo話</a> <a href="/tags/LLVM/" style="font-size: 10.77px;">LLVM</a> <a href="/tags/Linux/" style="font-size: 10.77px;">Linux</a> <a href="/tags/Pleroma/" style="font-size: 10.77px;">Pleroma</a> <a href="/tags/PostgreSQL/" style="font-size: 10px;">PostgreSQL</a> <a href="/tags/Python/" style="font-size: 12.31px;">Python</a> <a href="/tags/R-18/" style="font-size: 11.54px;">R-18</a> <a href="/tags/Racket/" style="font-size: 10px;">Racket</a> <a href="/tags/Rust/" style="font-size: 10.77px;">Rust</a> <a href="/tags/SILE/" style="font-size: 10.77px;">SILE</a> <a href="/tags/Scheme/" style="font-size: 13.08px;">Scheme</a> <a href="/tags/Shell-script/" style="font-size: 10px;">Shell script</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/Wiki/" style="font-size: 10.77px;">Wiki</a> <a href="/tags/code/" style="font-size: 10px;">code</a> <a href="/tags/%E4%BA%8C%E3%80%87%E5%9B%9B%E4%BA%94/" style="font-size: 16.15px;">二〇四五</a> <a href="/tags/%E4%BF%A1%E4%BB%B0/" style="font-size: 10px;">信仰</a> <a href="/tags/%E5%85%AC%E8%B7%AF/" style="font-size: 13.08px;">公路</a> <a href="/tags/%E5%88%86%E8%A1%8C%E6%95%A3%E6%96%87%E6%88%96%E8%A9%A9/" style="font-size: 16.92px;">分行散文或詩</a> <a href="/tags/%E5%8F%B0%EF%BC%8E%E4%B8%AD%E6%95%85%E4%BA%8B/" style="font-size: 13.08px;">台．中故事</a> <a href="/tags/%E5%9E%8B%E5%88%A5%E7%90%86%E8%AB%96/" style="font-size: 10px;">型別理論</a> <a href="/tags/%E5%AD%97%E5%9E%8B/" style="font-size: 10px;">字型</a> <a href="/tags/%E5%AE%A2%E5%AE%B6/" style="font-size: 10px;">客家</a> <a href="/tags/%E5%AE%A2%E5%AE%B6%E8%A9%B1/" style="font-size: 10px;">客家話</a> <a href="/tags/%E5%B0%8F%E8%AA%AA/" style="font-size: 20px;">小說</a> <a href="/tags/%E5%B7%B4%E5%A3%AB/" style="font-size: 10.77px;">巴士</a> <a href="/tags/%E6%84%9B%E7%88%BE%E8%98%AD%E8%AA%9E/" style="font-size: 13.85px;">愛爾蘭語</a> <a href="/tags/%E6%89%93%E5%AD%97%E6%A9%9F/" style="font-size: 10px;">打字機</a> <a href="/tags/%E6%90%AD%E4%B9%98%E7%B4%80%E5%AF%A6/" style="font-size: 10px;">搭乘紀實</a> <a href="/tags/%E6%95%B8%E5%AD%B8/" style="font-size: 10.77px;">數學</a> <a href="/tags/%E6%96%87%E5%85%B7/" style="font-size: 10px;">文具</a> <a href="/tags/%E6%9D%B1%E5%8E%9F%E8%AA%9E/" style="font-size: 10px;">東原語</a> <a href="/tags/%E6%AD%8C%E8%A9%9E/" style="font-size: 11.54px;">歌詞</a> <a href="/tags/%E6%B2%92%E6%9C%89SNS%E7%9A%84%E6%97%A5%E5%AD%90/" style="font-size: 16.92px;">沒有SNS的日子</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 14.62px;">生活</a> <a href="/tags/%E7%9B%B4%E8%AD%AF%E5%99%A8/" style="font-size: 10px;">直譯器</a> <a href="/tags/%E7%B6%AD%E5%9F%BA%E7%99%BE%E7%A7%91/" style="font-size: 10px;">維基百科</a> <a href="/tags/%E8%AB%96/" style="font-size: 17.69px;">論</a> <a href="/tags/%E8%B3%87%E8%A8%8A/" style="font-size: 18.46px;">資訊</a> <a href="/tags/%E8%B3%A3%E5%87%BA%E8%AA%9E%E8%A8%80e%E5%B0%91%E5%B9%B4%E4%BA%BA/" style="font-size: 13.85px;">賣出語言ê少年人</a> <a href="/tags/%E9%96%80%E5%8F%A3%E5%9F%95%E8%A8%98%E4%BA%8B/" style="font-size: 10.77px;">門口埕記事</a> <a href="/tags/%E9%9A%A8%E7%AD%86/" style="font-size: 15.38px;">隨筆</a>
  </div>
</div>


  <div class="widget tag">
<h3 class="title">相關連結</h3>
<ul class="entry">
<!--
<li><strong><a target="_blank" rel="noopener" href="http://yoxemblog.wordpress.com">
舊 blog、舊文章 (於 Wordpress.com)</a></strong></li>
-->
<li><a target="_blank" rel="noopener" href="http://plurk.com/yoxem">
Plurk</a></li>
<li><a target="_blank" rel="noopener" href="https://g0v.social/@yoxem">
Mastodon (g0v.social)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.flickr.com/photos/yoxem/sets/">
Flickr 相簿（舊）</a></li>
<li><em><a href="http://yoxem.github.io/pages/index.html">
其他 (Yoxem's Homepage)……</a></em></li>
</ul>
</div>


  <div class="widget tag">
<h3 class="title">最近迴響</h3>
<ul class="entry"><script type="text/javascript" src="http://yoxem.disqus.com/recent_comments_widget.js?num_items=5&hide_mods=0&hide_avatars=0&avatar_size=32&excerpt_length=100"></script></div>
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2023 Yoxem Chen
  <br/>除非特殊說明本文作者均為 Yoxem Chen，其所作除非特殊指定外，均使用 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc-sa/2.5/tw/deed.zh_TW">CC BY-NC-SA 2.5 台灣授權</a>。<br/>

Except being noticed, the articles is written by Yoxem Chen and licensed under <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc-sa/2.5/tw/deed.en">CC BY-NC-SA 2.5 Taiwan Version</a>.<br/>

Powered by <a target="_blank" rel="noopener" href="http://hexo.io/index.html">Hexo</a>.
</div>
<div class="clearfix"></div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'yoxem';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>